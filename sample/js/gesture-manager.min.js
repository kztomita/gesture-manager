/*!
 * GestureManager
 *
 * Copyright (c) 2019 Kazuyoshi Tomita
 *
 * This software is released under the MIT License.
 * https://opensource.org/licenses/MIT
 *
 * Version: 1.0.0
 * Build: Wed May 01 2019 10:32:51 GMT+0900 (Japan Standard Time)
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).GestureManager={})}(this,function(t){"use strict";function h(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t){h(this,s),this.name=t}var u=function(){function u(t,e){h(this,u),void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return e(u,[{key:"clone",value:function(){return new u(this.x,this.y)}},{key:"plus",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"minus",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"normalize",value:function(){var t=this.size;return this.x/=t,this.y/=t,this}},{key:"angle",value:function(){var t=this.size;if(t<1)return 0;var e=this.x/t,n=Math.acos(e);return this.y<0&&(n=Math.PI+Math.PI-n),n}},{key:"rotate",value:function(t,e){void 0===e&&(e=new u(0,0));var n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=n*s-i*r+e.x,this.y=i*s+n*r+e.y,this}},{key:"size",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}]),u}();var n,r,o=function(){function t(){h(this,t),this.list=[]}return e(t,[{key:"addListener",value:function(t){this.list.push(t)}},{key:"removeListener",value:function(t){for(var e=0;e<this.list.length;e++)if(this.list[e]==t)return void this.list.splice(e,1)}},{key:"fire",value:function(){for(var t=0;t<this.list.length;t++)this.list[t].apply(this,arguments)}}]),t}(),a=function(){function r(t){var e=this;for(var n in h(this,r),this.node=t,this.tapWork={touchX:null,touchY:null,touchTime:null},this.lastTap=null,this.gestureWork={startPinchDistance:null,startAngle:0,startCenter:null},this.emulateGestureEvent=!1,this.eventHandlers={touchstart:function(t){e.touchStart(t)},touchmove:function(t){e.touchMove(t)},touchend:function(t){e.touchEnd(t)},gesturestart:function(t){e.gestureStart(t)},gesturechange:function(t){e.gestureChange(t)},gestureend:function(t){e.gestureEnd(t)}},this.eventHandlers)t.addEventListener(n,this.eventHandlers[n],!1);var i=navigator.userAgent.toLowerCase();if(-1!=i.indexOf("android")&&i.match(/android\s+([0-9.]+)/)){var s=RegExp.$1;4<=parseFloat(s)&&(this.emulateGestureEvent=!0)}}return e(r,[{key:"unbindEvent",value:function(){for(var t in this.eventHandlers)this.node.removeEventListener(t,this.eventHandlers[t],!1)}},{key:"gestureStart",value:function(t){var e=new s("gesturestart");this.dispatchEvent(e)}},{key:"gestureChange",value:function(t){var e=new s("gesturechange");e.scale=t.scale,e.rotation=t.rotation,e.center=this.gestureWork.startCenter,this.dispatchEvent(e),t.preventDefault()}},{key:"gestureEnd",value:function(t){var e=new s("gestureend");this.dispatchEvent(e)}},{key:"touchStart",value:function(t){var e=new Date;if(1==t.touches.length?(this.tapWork.touchX=t.touches[0].clientX,this.tapWork.touchY=t.touches[0].clientY,this.tapWork.touchTime=e.getTime()):this.tapWork.touchTime=null,2==t.touches.length){var n=new u(t.touches[1].clientX-t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY);this.gestureWork.startPinchDistance=n.size,this.gestureWork.startAngle=180*n.angle()/Math.PI,this.gestureWork.startCenter=new u((t.touches[1].clientX+t.touches[0].clientX)/2,(t.touches[1].clientY+t.touches[0].clientY)/2),this.emulateGestureEvent&&this.gestureStart(t)}t.preventDefault()}},{key:"touchMove",value:function(t){if(this.tapWork.touchTime&&(3<Math.abs(t.touches[0].clientX-this.tapWork.touchX)||3<Math.abs(t.touches[0].clientY-this.tapWork.touchY))&&(this.tapWork.touchTime=null),2<=t.touches.length&&this.emulateGestureEvent){var e=new u(t.touches[1].clientX-t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY),n=e.size,i=180*e.angle()/Math.PI;t.scale=n/this.gestureWork.startPinchDistance,t.rotation=i-this.gestureWork.startAngle,this.gestureChange(t)}t.preventDefault()}},{key:"touchEnd",value:function(t){if(0==t.touches.length&&null!==this.tapWork.touchTime){var e=new Date;if(e.getTime()-this.tapWork.touchTime<500){(n=new s("tap")).clientX=this.tapWork.touchX,n.clientY=this.tapWork.touchY,this.dispatchEvent(n);var n,i=!1;if(this.lastTap)if(e.getTime()-this.lastTap.time<500)(n=new s("doubletap")).clientX=this.tapWork.touchX,n.clientY=this.tapWork.touchY,this.dispatchEvent(n),t.preventDefault(),i=!0;this.lastTap=i?null:{x:this.tapWork.touchX,y:this.tapWork.touchY,time:e.getTime()}}}this.emulateGestureEvent&&1==t.touches.length&&this.gestureEnd(t)}}]),r}();(n=a.prototype)[r="listeners"]={},n.addEventListener=function(t,e){n[r][t]||(n[r][t]=new o),n[r][t].addListener(e)},n.removeEventListener=function(t,e){n[r][t]&&n[r][t].removeListener(e)},n.dispatchEvent=function(t){n[r][t.name]&&n[r][t.name].fire(t)},t.createGestureManager=function(t){return"string"==typeof t&&(t=document.querySelector(t)),new a(t)},Object.defineProperty(t,"__esModule",{value:!0})});