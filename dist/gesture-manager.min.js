/*!
 * GestureManager
 *
 * Copyright (c) 2019 Kazuyoshi Tomita
 *
 * This software is released under the MIT License.
 * https://opensource.org/licenses/MIT
 *
 * Version: 1.0.1
 * Build: Fri May 10 2019 14:25:13 GMT+0900 (Japan Standard Time)
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).GestureManager={})}(this,function(t){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function e(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function o(t){a(this,o),this.name=t}var u=function(){function o(t,e){a(this,o),void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return e(o,[{key:"clone",value:function(){return new o(this.x,this.y)}},{key:"plus",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"minus",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"scale",value:function(t){return this.x*=t,this.y*=t,this}},{key:"dot",value:function(t){return this.x*t.x+this.y*t.y}},{key:"normalize",value:function(){var t=this.size;return this.x/=t,this.y/=t,this}},{key:"angle",value:function(){var t=this.size;if(t<1)return 0;var e=this.x/t,n=Math.acos(e);return this.y<0&&(n=Math.PI+Math.PI-n),n}},{key:"rotate",value:function(t,e){void 0===e&&(e=new o(0,0));var n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=n*s-i*r+e.x,this.y=i*s+n*r+e.y,this}},{key:"size",get:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}}]),o}();function n(n,i){n[i]={},n.addEventListener=function(t,e){n[i][t]||(n[i][t]=new s),n[i][t].addListener(e)},n.removeEventListener=function(t,e){n[i][t]&&n[i][t].removeListener(e)},n.dispatchEvent=function(t){n[i][t.name]&&n[i][t.name].fire(t)}}var s=function(){function t(){a(this,t),this.list=[]}return e(t,[{key:"addListener",value:function(t){this.list.push(t)}},{key:"removeListener",value:function(t){for(var e=0;e<this.list.length;e++)if(this.list[e]==t)return void this.list.splice(e,1)}},{key:"fire",value:function(){for(var t=0;t<this.list.length;t++)this.list[t].apply(this,arguments)}}]),t}(),r=function(){function r(t){var e=this;for(var n in a(this,r),this.node=t,this.tapWork={touchX:null,touchY:null,touchTime:null},this.lastTap=null,this.gestureWork={startPinchDistance:null,startAngle:0,startCenter:null},this.emulateGestureEvent=!1,this.eventHandlers={touchstart:function(t){e.touchStart(t)},touchmove:function(t){e.touchMove(t)},touchend:function(t){e.touchEnd(t)},gesturestart:function(t){e.gestureStart(t)},gesturechange:function(t){e.gestureChange(t)},gestureend:function(t){e.gestureEnd(t)}},this.eventHandlers)t.addEventListener(n,this.eventHandlers[n],!1);var i=navigator.userAgent.toLowerCase();if(-1!=i.indexOf("android")&&i.match(/android\s+([0-9.]+)/)){var s=RegExp.$1;4<=parseFloat(s)&&(this.emulateGestureEvent=!0)}}return e(r,[{key:"unbindEvent",value:function(){for(var t in this.eventHandlers)this.node.removeEventListener(t,this.eventHandlers[t],!1)}},{key:"gestureStart",value:function(t){var e=new o("gesturestart");this.dispatchEvent(e)}},{key:"gestureChange",value:function(t){var e=new o("gesturechange");e.scale=t.scale,e.rotation=t.rotation,e.center=this.gestureWork.startCenter,this.dispatchEvent(e),t.preventDefault()}},{key:"gestureEnd",value:function(t){var e=new o("gestureend");this.dispatchEvent(e)}},{key:"touchStart",value:function(t){var e=new Date;if(1==t.touches.length?(this.tapWork.touchX=t.touches[0].clientX,this.tapWork.touchY=t.touches[0].clientY,this.tapWork.touchTime=e.getTime()):this.tapWork.touchTime=null,2==t.touches.length){var n=new u(t.touches[1].clientX-t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY);this.gestureWork.startPinchDistance=n.size,this.gestureWork.startAngle=180*n.angle()/Math.PI,this.gestureWork.startCenter=new u((t.touches[1].clientX+t.touches[0].clientX)/2,(t.touches[1].clientY+t.touches[0].clientY)/2),this.emulateGestureEvent&&this.gestureStart(t)}t.preventDefault()}},{key:"touchMove",value:function(t){if(this.tapWork.touchTime&&(3<Math.abs(t.touches[0].clientX-this.tapWork.touchX)||3<Math.abs(t.touches[0].clientY-this.tapWork.touchY))&&(this.tapWork.touchTime=null),2<=t.touches.length&&this.emulateGestureEvent){var e=new u(t.touches[1].clientX-t.touches[0].clientX,t.touches[1].clientY-t.touches[0].clientY),n=e.size,i=180*e.angle()/Math.PI;t.scale=n/this.gestureWork.startPinchDistance,t.rotation=i-this.gestureWork.startAngle,this.gestureChange(t)}t.preventDefault()}},{key:"touchEnd",value:function(t){if(0==t.touches.length&&null!==this.tapWork.touchTime){var e=new Date;if(e.getTime()-this.tapWork.touchTime<500){(n=new o("tap")).clientX=this.tapWork.touchX,n.clientY=this.tapWork.touchY,this.dispatchEvent(n);var n,i=!1;if(this.lastTap)if(e.getTime()-this.lastTap.time<500)(n=new o("doubletap")).clientX=this.tapWork.touchX,n.clientY=this.tapWork.touchY,this.dispatchEvent(n),t.preventDefault(),i=!0;this.lastTap=i?null:{x:this.tapWork.touchX,y:this.tapWork.touchY,time:e.getTime()}}}this.emulateGestureEvent&&1==t.touches.length&&this.gestureEnd(t)}}]),r}();n(r.prototype,"listeners");var h=function(){function i(t){var e=this;for(var n in a(this,i),this.node=t,this.tapWork={touchX:null,touchY:null,touchTime:null},this.gestureWork={startPinchDistance:null,startAngle:0,startCenter:null,pointers:{}},this.emulateGestureEvent=!1,this.eventHandlers={MSPointerDown:function(t){e.pointerDown(t)},MSPointerMove:function(t){e.pointerMove(t)},MSPointerUp:function(t){e.pointerUp(t)},MSPointerCancel:function(t){e.pointerUp(t)}},this.eventHandlers)t.addEventListener(n,this.eventHandlers[n],!1)}return e(i,[{key:"unbindEvent",value:function(){for(var t in this.eventHandlers)this.node.removeEventListener(t,this.eventHandlers[t],!1)}},{key:"pointerCount",value:function(){var t=0;for(var e in this.gestureWork.pointers)t++;return t}},{key:"gestureStart",value:function(t){var e=new o("gesturestart");this.dispatchEvent(e)}},{key:"gestureChange",value:function(t){var e=new o("gesturechange");e.scale=t._scale,e.rotation=t._rotation,e.center=this.gestureWork.startCenter,this.dispatchEvent(e),t.preventDefault()}},{key:"gestureEnd",value:function(t){var e=new o("gestureend");this.dispatchEvent(e)}},{key:"pointerDown",value:function(t){t.preventDefault(),this.gestureWork.pointers[t.pointerId]={clientX:t.clientX,clientY:t.clientY};var e=this.pointerCount(),n=new Date;if(1==e?(this.tapWork.touchX=t.clientX,this.tapWork.touchY=t.clientY,this.tapWork.touchTime=n.getTime()):this.tapWork.touchTime=null,2==e){var i=[];for(var s in this.gestureWork.pointers)i.push(this.gestureWork.pointers[s]);var r=new u(i[1].clientX-i[0].clientX,i[1].clientY-i[0].clientY);this.gestureWork.startPinchDistance=r.size,this.gestureWork.startAngle=180*r.angle()/Math.PI,this.gestureWork.startCenter=new u((i[1].clientX+i[0].clientX)/2,(i[1].clientY+i[0].clientY)/2),this.gestureStart(t)}t.preventDefault()}},{key:"pointerMove",value:function(t){var e=this.gestureWork.pointers[t.pointerId];if(e){if(this.tapWork.touchTime&&(10<Math.abs(t.clientX-this.tapWork.touchX)||10<Math.abs(t.clientY-this.tapWork.touchY))&&(this.tapWork.touchTime=null),e.clientX=t.clientX,e.clientY=t.clientY,2<=this.pointerCount()){var n=[];for(var i in this.gestureWork.pointers)n.push(this.gestureWork.pointers[i]);var s=new u(n[1].clientX-n[0].clientX,n[1].clientY-n[0].clientY),r=s.size,o=180*s.angle()/Math.PI;t._scale=r/this.gestureWork.startPinchDistance,t._rotation=o-this.gestureWork.startAngle,this.gestureChange(t)}t.preventDefault()}}},{key:"pointerUp",value:function(t){delete this.gestureWork.pointers[t.pointerId];var e=this.pointerCount();if(0==e&&null!==this.tapWork.touchTime){var n=new Date;if(n.getTime()-this.tapWork.touchTime<500){(i=new o("tap")).clientX=this.tapWork.touchX,i.clientY=this.tapWork.touchY,this.dispatchEvent(i);var i,s=!1;if(this.lastTap)if(n.getTime()-this.lastTap.time<500)(i=new o("doubletap")).clientX=this.tapWork.touchX,i.clientY=this.tapWork.touchY,this.dispatchEvent(i),t.preventDefault(),s=!0;this.lastTap=s?null:{x:this.tapWork.touchX,y:this.tapWork.touchY,time:n.getTime()}}}1==e&&this.gestureEnd(t)}}]),i}();n(h.prototype,"listeners"),t.createGestureManager=function(t){return"string"==typeof t&&(t=document.querySelector(t)),navigator.userAgent.toLowerCase(),window.navigator.msPointerEnabled?new h(t):new r(t)},Object.defineProperty(t,"__esModule",{value:!0})});